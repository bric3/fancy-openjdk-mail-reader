# Claude Code Instructions

This project was entirely generated by Claude as an experiment.

## Project Overview

Fancy Mail is a Micronaut application that fetches and beautifies emails from OpenJDK mailing lists, converting them to clean markdown or rendered HTML.

## Tech Stack

- **Framework**: Micronaut 4.x
- **CLI**: Picocli
- **HTML Parsing**: Jsoup
- **Markdown**: Flexmark
- **Templates**: JTE
- **Caching**: Caffeine
- **Java**: 25

## Build Commands

```bash
# Run in server mode (always use --continuous for auto-recompilation)
./gradlew --continuous run --args="--server"

# Run in dev mode (shows debug info like full Merkle hashes and stack traces)
./gradlew --continuous run --args="--server --dev"

# Run tests
./gradlew test

# Build
./gradlew build

# Build Docker image locally
./gradlew jibDockerBuild

# Push to Google Container Registry
./gradlew jib -PgcpProjectId=YOUR_PROJECT_ID
```

## Project Structure

```
app/src/main/java/dev/brice/fancymail/
├── Application.java              # Entry point
├── FancyMailCommand.java         # CLI (Picocli)
├── controller/
│   └── MailController.java       # Web endpoints
├── service/
│   ├── MailFetcher.java          # HTTP client
│   ├── MailParser.java           # HTML parsing
│   ├── MarkdownConverter.java    # HTML to Markdown
│   ├── LinkRewriter.java         # URL rewriting
│   └── MailService.java          # Orchestration
├── cache/
│   └── MailCache.java            # Caffeine cache
└── model/
    ├── MailPath.java             # URL/path parsing
    └── ParsedMail.java           # Email record

app/src/main/jte/                 # JTE templates
app/src/main/resources/
├── application.yml               # Configuration
└── logback.xml                   # Logging
```

## Key Endpoints

- `GET /` - Home page with URL input form
- `GET /rendered/{list}/{year-month}/{id}.html` - Rendered email view
- `GET /markdown/{list}/{year-month}/{id}.md` - Raw markdown

## Configuration

Configuration is in `app/src/main/resources/application.yml`. The server port respects the `PORT` environment variable for Cloud Run compatibility.

## Testing

Tests are in `app/src/test/java/`. Run with:

```bash
./gradlew test
```

### Test Fixtures

Test fixtures are located in `app/src/test/resources/fixtures/`. The `.md` files contain expected markdown output that has been manually curated. **Do not auto-regenerate these files** - they represent the desired output and are used to validate parsing correctness.

## Deployment

See `DEPLOYING.md` for Google Cloud Run deployment instructions.
